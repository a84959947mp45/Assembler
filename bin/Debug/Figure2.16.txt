0	COPY	START	0
1		EXTDEF	BUFFER,BUFEND,LENGTH
2		EXTREF	RDREC,WRREC
3	FIRST	STL	RETADR		
4	CLOOP  +JSUB	RDREC		
5		LDA	LENGTH		
6		COMP   #0		
7		JEQ	ENDFIL		
8	       +JSUB	WRREC		
9		J	CLOOP		
10	ENDFIL	LDA    =C'EOF'		
11		STA	BUFFER		
12		LDA    #3		
13		STA	LENGTH		
14	       +JSUB	WRREC		
15		J      @RETADR		
16	RETADR	RESW	1
17	LENGTH	RESW	1
18		LTORG		
19	BUFFER	RESB	4096
20	BUFEND	EQU	*
21	MAXLEN	EQU	BUFEND-BUFFER
22	
23	RDREC	CSECT
24			.
25			.	SUBROUTTINE TO READ RECORD INTO BUFFER
26			.
27		EXTREF	BUFFER,LENGTH,BUFEND
28		CLEAR	X		
29		CLEAR	A		
30		CLEAR	S		
31		LDT	MAXLEN		
32	RLOOP	TD	INPUT		
33		JEQ	RLOOP		
34		RD	INPUT		
35		COMPR	A,S		
36		JEQ	EXIT		
37	       +STCH	BUFFER,X	
38		TIXR	T		
39		JLT	RLOOP		
40	EXIT   +STX	LENGTH		
41		RSUB			
42	INPUT	BYTE	X'F1'		
43	MAXLEN	WORD	BUFEND-BUFFER	
44	
45	WRREC	CSECT
46			.
47			.	SUBROUTINE TO WRITE RECORD FROM BUFFER
48			.
49		EXTREF	LENGTH,BUFFER
50		CLEAR	X		
51	       +LDT	LENGTH		
52	WLOOP	TD     =X'05'		
53		JEQ	WLOOP		
54		+LDCH	BUFFER,X	
55		WD     =X'05'		
56		TIXR	T		
57		JLT	WLOOP		
58		RSUB			
59		END	FIRST
